---
AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    Runtime: python3.11

Parameters:
  RootDomain:
    Type: String
    Default: gustavomejia.tech
    Description: "Root domain for the API Gateway"

Resources:
  # ðŸŸ£ External Domain
  MyHostedDomain:
    Type: AWS::Route53::HostedZone
    Properties:
      Name: !Sub "${RootDomain}"

  # ðŸ”´ SSL Certificate
  ACMCertificate:
    Type: AWS::CertificateManager::Certificate
    Properties:
      DomainName: !Sub "*.${RootDomain}"
      ValidationMethod: DNS
      DomainValidationOptions:
        - DomainName: !Sub "*.${RootDomain}"
          HostedZoneId: !Ref MyHostedDomain

  # ðŸŸ£ Subdomain Api Gateway http api
  ExampleSubdomainApiGateway:
    Type: AWS::Serverless::HttpApi
    Properties:
      Name: !Sub "${AWS::StackName}-ExampleSubdomain"  # âœ… Use Resource name
      StageName: Prod
      Domain:
        DomainName: !Sub "example.${RootDomain}"  # âœ… Ahora usa el valor correcto
        CertificateArn: !Ref ACMCertificate
        EndpointConfiguration: REGIONAL
        Route53:
          HostedZoneId: !Ref MyHostedDomain

  # ðŸŸ  Lambda Functions
  ExampleApi:  # âœ… Use your own name
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambdas/ExampleFunction/  # âœ… Use your own directory
      Description: "This is an example. Use it as a reference to create your own endpoint." # âœ… Use your own description
      FunctionName: !Sub "${AWS::StackName}-ExampleApi"  # âœ… Use Resource name
      Handler: app.lambda_handler
      Policies:
        - AWSLambdaBasicExecutionRole
      Events:
        ExampleAPIEvent:
          Type: HttpApi
          Properties:
            ApiId: !Ref ExampleSubdomainApiGateway
            Method: GET
            Path: /example  # Use your own path

  ExampleFunction:  # Use your own name
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambdas/ExampleFunction/  # Use your own path
      Description: "This is an example. Use it as a reference to create your own function." # âœ… Use your own description
      FunctionName: !Sub "${AWS::StackName}-ExampleFunction"  # âœ… Use Resource name
      Handler: app.lambda_handler
      Policies:
        - AWSLambdaBasicExecutionRole

  HelloWorldCamicase:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambdas/HelloWorldCamicase/
      Description: "Hello world of Camicase" # âœ… Use your own description
      FunctionName: !Sub "${AWS::StackName}-HelloWorldCamicase"  # âœ… Use Resource name
      Handler: app.lambda_handler
      Policies:
        - AWSLambdaBasicExecutionRole

Outputs:
  HostedZoneNameServers:
    Description: "Please copy the name servers below to your DNS provider"
    Value: !Join [",", !GetAtt MyHostedDomain.NameServers]
  HostedZoneArn:
    Description: "Please use this Id to create records"
    Value: !GetAtt MyHostedDomain.Id
  StackInfo:
    Value: !Sub "Stack name: ${AWS::StackName}, Id: ${AWS::StackId}" 
...
